<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=no"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="icon" type="image/png" href="../img/logo.png" sizes="192x192">
    <title>数字迷图</title>
    <link rel="stylesheet" href="../css/mdui.min.css"/>
    <link rel="stylesheet" href="../css/docs.css"/>
    <link rel="stylesheet" href="../css/theme.css"/>
</head>

<body
        class="mdui-drawer-body-left mdui-appbar-with-toolbar mdui-loaded mdui-theme-layout-dark mdui-theme-primary-teal mdui-theme-accent-teal">
<header class="mdui-appbar mdui-appbar-fixed">
    <div class="mdui-toolbar mdui-color-theme">
            <span class="mdui-btn mdui-btn-icon mdui-ripple mdui-ripple-white"
                  mdui-drawer="{target: '#main-drawer', swipe: true}"><i
                    class="mdui-icon material-icons">menu</i></span>
        <a href="#" class="mdui-typo-headline mdui-hidden-xs">小梦岛</a>
        <div class="mdui-toolbar-spacer"></div>
    </div>
</header>
<div class="mdui-drawer" id="main-drawer">
    <div class="mdui-list" mdui-collapse="{accordion: true}" style="margin-bottom: 76px;">
        <div class="mdui-collapse-item">
            <div class="mdui-collapse-item-header mdui-list-item mdui-ripple">
                <i class="mdui-list-item-icon mdui-icon material-icons mdui-text-color-blue">near_me</i>
                <div class="mdui-list-item-content">
                    关于我
                </div>
                <i class="mdui-collapse-item-arrow mdui-icon material-icons">keyboard_arrow_down</i>
            </div>
            <div class="mdui-collapse-item-body mdui-list">
                <a href="../index.html" class="mdui-list-item mdui-ripple ">说明</a>
            </div>
        </div>
    </div>
</div>
<div class="mdui-container doc-container doc-no-cover">
    <div class="mdui-typo">
        <h1>
            <span>数字谜图</span>
            <small id="time">计时3分钟</small>
        </h1>
        <div style="font-size: 15px;">
            <a href="#" onclick="hint();">提示</a>
            <span id="hint">嘻嘻嘻，游戏不会太难吧</span>
        </div>
        <h4 id="title">准备好了么？</h4>
        <div id="box">
            <p>选择矩阵的SIZE：</p>
            <label class="mdui-slider mdui-slider-discrete">
                <input id="size" type="range" step="1" min="4" max="8"/>
            </label>
            <button onclick="let size = document.getElementById('size').value; create(size);start(size);"
                    class="mdui-btn mdui-btn-raised mdui-btn-dense mdui-color-theme-accent mdui-ripple">开始游戏
            </button>

        </div>
        <script>
            var tip = "为什么不先试一下";
            var wrong = "null";
            var pos = [];
            var pans = [];
            var rows = [];
            var cols = [];
            var i, j, t;

            function create(size) {
                document.getElementById("box").innerHTML = "";
                const SIZE = size;
                let box = document.getElementById("box");
                for (i = 0; i < SIZE; i++) {
                    pos[i] = [];
                    pans[i] = [];
                    for (j = 0; j < SIZE; j++) {
                        pos[i][j] = Math.round(Math.random());
                        pans[i][j] = 0;
                    }
                }

                for (i = 0; i < SIZE; i++) {
                    let count = 0;
                    let counts = [];
                    for (j = 0; j < SIZE; j++) {
                        if (count !== 0 && pos[i][j] === 0) {
                            counts.push(count);
                            count = 0;
                        }
                        if (pos[i][j] === 1) {
                            count += 1;
                        }
                        if (pos[i][j] === 1 && j === SIZE - 1) {
                            counts.push(count);
                        }
                        if (counts.length === 0 && j === SIZE - 1) {
                            counts.push(0);
                        }
                    }
                    rows.push(counts);
                }

                for (j = 0; j < SIZE; j++) {
                    let count = 0;
                    let counts = [];
                    for (i = 0; i < SIZE; i++) {
                        if (count !== 0 && pos[i][j] === 0) {
                            counts.push(count);
                            count = 0;
                        }
                        if (pos[i][j] === 1) {
                            count += 1;
                        }
                        if (pos[i][j] === 1 && i === SIZE - 1) {
                            counts.push(count);
                        }
                        if (counts.length === 0 && i === SIZE - 1) {
                            counts.push(0);
                        }
                    }
                    cols.push(counts);
                }

                let div_row = document.createElement("div");
                div_row.classList.add("mdui-row");
                for (i = 0; i < cols.length; i++) {
                    let item = document.createElement("div");
                    item.classList.add("mdui-col-xs-1");
                    let html = "";
                    cols[i].map(item => {
                        html += item;
                        html += "<br />";
                    });
                    item.innerHTML = html;
                    div_row.append(item);
                }
                box.append(div_row);

                for (i = 0; i < SIZE; i++) {
                    let row2 = document.createElement("div");
                    row2.classList.add("mdui-row");
                    for (j = 0; j < SIZE; j++) {
                        let div3 = document.createElement("div");
                        div3.classList.add("mdui-col-xs-1");
                        let posx = i;
                        let posy = j;
                        let label = document.createElement("label");
                        label.classList.add("mdui-checkbox");
                        let input = document.createElement("input");
                        input.type = "checkbox";
                        input.id = i + "-" + j;
                        input.onclick = function () {
                            document.getElementById("title").innerText = "游戏开始了！";
                            if (pans[posx][posy] === 0) {
                                pans[posx][posy] = 1;
                            } else {
                                pans[posx][posy] = 0;
                            }
                            check(SIZE);
                        };
                        let icon = document.createElement("i");
                        icon.id = i + "-" + j+ "-icon";
                        icon.classList.add("mdui-checkbox-icon");
                        label.append(input);
                        label.append(icon);
                        div3.append(label);
                        row2.append(div3);
                    }
                    let item2 = document.createElement("div");
                    item2.classList.add("mdui-col-xs-3");
                    let html = "";
                    rows[i].map(item => {
                        html += item;
                        html += " ";
                    });
                    item2.innerHTML = html;
                    row2.append(item2);
                    box.append(row2);
                }
            }

            function check(size) {
                const SIZE = size;
                flag = true;
                wrong = "null";
                for (i = 0; i < SIZE; i++) {
                    for (j = 0; j < SIZE; j++) {
                        if (pos[i][j] !== pans[i][j]) {
                            flag = false;
                        }
                        if (pos[i][j] === 1 && pans[i][j] === 0) {
                            tip = "第" + (i + 1) + "行第" + (j + 1) + "个 是一个你没有发现的点。"
                        }
                        if (pos[i][j] === 0 && pans[i][j] === 1) {
                            wrong = "第" + (i + 1) + "行第" + (j + 1) + "个 你可能点错了"
                        }
                    }
                }
                if (flag) {
                    let it = document.getElementById("title");
                    mdui.snackbar({
                        message: '你赢了'
                    });
                    clearTimeout(t);
                    it.innerHTML = "<span>你赢了！</span><button onclick='location.reload()' class='mdui-btn mdui-btn-raised mdui-btn-dense mdui-color-theme-accent mdui-ripple'>再玩一局</button>";
                }
            }

            function hint() {
                if (wrong === "null") {
                    document.getElementById("hint").innerText = tip;
                } else {
                    document.getElementById("hint").innerText = wrong;
                }
            }

            /*
时间倒计时插件
TimeDown.js
*/
            function TimeDown(id, time, SIZE) {
                //相差的总秒数
                var totalSeconds = parseInt(time);

                totalSeconds -= 1;
                //取模（余数）
                var modulo = totalSeconds % (60 * 60 * 24) % (60 * 60);
                //分钟
                var minutes = Math.floor(modulo / 60);
                //秒
                var seconds = modulo % 60;
                //输出到页面
                if (minutes < 1) {
                    document.getElementById(id).classList.add("mdui-text-color-pink");
                }
                document.getElementById(id).innerHTML = "还剩:" + minutes + "分钟" + seconds + "秒";

                //延迟一秒执行自己
                t = setTimeout(function () {
                    TimeDown(id, totalSeconds, SIZE);
                    checkTime(minutes, seconds, SIZE);
                }, 1000);
            }

            function checkTime(minutes, seconds, SIZE) {
                if (minutes === 0 && seconds === 1) {
                    let it = document.getElementById("title");
                    mdui.snackbar({
                        message: '你超时了'
                    });
                    clearTimeout(t);
                    for (i = 0; i < SIZE; i++) {
                        for (j = 0; j < SIZE; j++) {
                            let id = i + "-" + j;
                            let iconid = id + "-icon";
                            document.getElementById(id).disabled = true;
                            if (pos[i][j] === 1) {
                                document.getElementById(id).checked = true;
                            }
                            if (pans[i][j] === 1 && pos[i][j] === 1) {
                                document.getElementById(iconid).style.background = "green";
                            }
                            if (pans[i][j] === 1 && pos[i][j] === 0) {
                                document.getElementById(iconid).style.background = "red";
                            }
                        }
                    }
                    it.innerHTML = "<span>时间到，你输了！</span><button onclick='location.reload()' class='mdui-btn mdui-btn-raised mdui-btn-dense mdui-color-theme-accent mdui-ripple'>再玩一局</button>";
                }
            }

            function start(SIZE) {
                if (document.getElementById("time").innerText === "计时3分钟") {
                    TimeDown("time", 181, SIZE);
                }
            }
        </script>
    </div>
</div>
<script src="../js/jquery-3.1.1.min.js"></script>
<script src="../js/smooth-scroll.min.js"></script>
<script src="../js/mdui.min.js?v=0.4.3"></script>
</body>

</html>